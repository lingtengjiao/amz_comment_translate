# ğŸš€ GitHub Actions è‡ªåŠ¨éƒ¨ç½²æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²é…ç½® GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥ä½œæµã€‚å½“æ‚¨å°†ä»£ç æ¨é€åˆ° `main` åˆ†æ”¯æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ï¼š

1. **åŒæ­¥ä»£ç ** åˆ°ç«å±±äº‘æœåŠ¡å™¨
2. **æ„å»º Docker é•œåƒ**
3. **é‡å¯æœåŠ¡** å®Œæˆéƒ¨ç½²

## ğŸ—ï¸ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GitHub                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    push     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   æœ¬åœ°ä»£ç    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   GitHub Repo    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚ trigger
                                        â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  GitHub Actions  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚ SSH + rsync
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â–¼                                   â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Server A      â”‚                 â”‚   Server B      â”‚
           â”‚  (ä¸»æœåŠ¡å™¨)      â”‚                 â”‚  (WorkerèŠ‚ç‚¹)   â”‚
           â”‚ 115.191.30.209  â”‚                 â”‚ 115.190.185.29  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: ç”Ÿæˆå¹¶é…ç½® SSH å¯†é’¥

è¿è¡Œè®¾ç½®è„šæœ¬ï¼Œç”Ÿæˆä¸“ç”¨äº GitHub Actions çš„ SSH å¯†é’¥ï¼š

```bash
cd /Users/lingtengjiao/AIé¡¹ç›®/amz_comment_translate
chmod +x deploy/setup-github-ssh.sh
./deploy/setup-github-ssh.sh
```

è„šæœ¬ä¼šï¼š
- ç”Ÿæˆæ–°çš„ Ed25519 SSH å¯†é’¥å¯¹
- è‡ªåŠ¨å°†å…¬é’¥æ·»åŠ åˆ°ä¸¤å°æœåŠ¡å™¨
- è¾“å‡ºç§é’¥å†…å®¹ä¾›æ‚¨å¤åˆ¶

### æ­¥éª¤ 2: é…ç½® GitHub Secrets

1. è®¿é—®ä»“åº“è®¾ç½®é¡µé¢ï¼š
   https://github.com/lingtengjiao/amz_comment_translate/settings/secrets/actions

2. ç‚¹å‡» **"New repository secret"** æ·»åŠ ä»¥ä¸‹ Secretsï¼š

| Secret åç§° | å€¼ |
|------------|---|
| `SSH_PRIVATE_KEY` | è„šæœ¬è¾“å‡ºçš„ç§é’¥å†…å®¹ï¼ˆå®Œæ•´å¤åˆ¶ï¼ŒåŒ…æ‹¬ `-----BEGIN` å’Œ `-----END` è¡Œï¼‰ |
| `SERVER_A_IP` | `115.191.30.209` |
| `SERVER_B_IP` | `115.190.185.29` |
| `SERVER_USER` | `root` |
| `QWEN_API_KEY` | `sk-bb9ae189dc3b4b85a9d5bd156254de76` |

### æ­¥éª¤ 3: éªŒè¯é…ç½®

1. æ¨é€ä»£ç åˆ° main åˆ†æ”¯ï¼š
   ```bash
   git add .
   git commit -m "feat: æ·»åŠ  GitHub Actions è‡ªåŠ¨éƒ¨ç½²"
   git push origin main
   ```

2. æŸ¥çœ‹ Actions æ‰§è¡ŒçŠ¶æ€ï¼š
   https://github.com/lingtengjiao/amz_comment_translate/actions

## ğŸ”„ å·¥ä½œæµè¯´æ˜

### è‡ªåŠ¨è§¦å‘

- **Push åˆ° main åˆ†æ”¯**ï¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
- **æ’é™¤**ï¼šä»…ä¿®æ”¹ `.md` æ–‡ä»¶æˆ– `docs/` ç›®å½•ä¸è§¦å‘

### æ‰‹åŠ¨è§¦å‘

1. è®¿é—® Actions é¡µé¢
2. é€‰æ‹© **"ğŸš€ Deploy to Production"** å·¥ä½œæµ
3. ç‚¹å‡» **"Run workflow"**
4. å¯é€‰æ‹©éƒ¨ç½²ç›®æ ‡ï¼š
   - `all`: éƒ¨ç½²åˆ°æ‰€æœ‰æœåŠ¡å™¨ï¼ˆé»˜è®¤ï¼‰
   - `server-a`: ä»…éƒ¨ç½²ä¸»æœåŠ¡å™¨
   - `server-b`: ä»…éƒ¨ç½² Worker èŠ‚ç‚¹

## ğŸ“Š éƒ¨ç½²æµç¨‹è¯¦è§£

### Server A (ä¸»æœåŠ¡å™¨) éƒ¨ç½²

1. **ä»£ç åŒæ­¥**: é€šè¿‡ rsync å¢é‡åŒæ­¥ï¼Œæ’é™¤éå¿…è¦æ–‡ä»¶
2. **ç¯å¢ƒé…ç½®**: è‡ªåŠ¨ç”Ÿæˆ `.env` æ–‡ä»¶
3. **é•œåƒæ„å»º**: `docker-compose -f docker-compose-master.yml build`
4. **ä¼˜é›…é‡å¯**: 
   - å…ˆé‡å¯åç«¯å’Œ Workerï¼ˆä¿æŒæ•°æ®åº“è¿è¡Œï¼‰
   - å†é‡å¯å‰ç«¯å’Œ Nginx
5. **å¥åº·æ£€æŸ¥**: éªŒè¯ API å’Œå‰ç«¯å¯è®¿é—®

### Server B (Worker èŠ‚ç‚¹) éƒ¨ç½²

1. **ä»£ç åŒæ­¥**: ä»…åŒæ­¥ backend ç›¸å…³ä»£ç 
2. **ç¯å¢ƒé…ç½®**: é…ç½® `MASTER_IP` æŒ‡å‘ Server A
3. **é•œåƒæ„å»º**: `docker-compose -f docker-compose-worker.yml build`
4. **é‡å¯ Worker**: é‡å»ºæ‰€æœ‰ Worker å®¹å™¨
5. **éªŒè¯æ³¨å†Œ**: æ£€æŸ¥ Worker æ˜¯å¦åœ¨ Flower ä¸­æ³¨å†Œ

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¯†é’¥å®‰å…¨

- **æ°¸è¿œä¸è¦** å°† SSH ç§é’¥æäº¤åˆ°ä»£ç ä»“åº“
- ç§é’¥ä»…å­˜å‚¨åœ¨ GitHub Secrets ä¸­
- å¦‚æœç§é’¥æ³„éœ²ï¼Œç«‹å³åœ¨æœåŠ¡å™¨ä¸Šåˆ é™¤å¯¹åº”å…¬é’¥å¹¶é‡æ–°ç”Ÿæˆ

### éƒ¨ç½²æœŸé—´

- éƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡ä¼šçŸ­æš‚ä¸­æ–­ï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰
- æ•°æ®åº“å’Œ Redis ä¸ä¼šé‡å¯ï¼Œæ•°æ®å®‰å…¨
- å¦‚æœéƒ¨ç½²å¤±è´¥ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨å›æ»šåˆ°ä¹‹å‰çš„çŠ¶æ€

### å›æ»š

å¦‚éœ€å›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬ï¼š

```bash
# æ–¹æ³• 1: Git å›æ»š
git revert HEAD
git push origin main

# æ–¹æ³• 2: æ‰‹åŠ¨å›æ»š
# SSH åˆ°æœåŠ¡å™¨æ‰§è¡Œ
docker-compose -f docker-compose-master.yml logs --tail 100
# æ£€æŸ¥é—®é¢˜åæ‰‹åŠ¨æ¢å¤
```

## ğŸ” æ•…éšœæ’æŸ¥

### Actions æ‰§è¡Œå¤±è´¥

1. æŸ¥çœ‹ Actions æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯
2. å¸¸è§é—®é¢˜ï¼š
   - SSH è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ SSH_PRIVATE_KEY æ˜¯å¦æ­£ç¡®
   - rsync å¤±è´¥ â†’ æ£€æŸ¥æœåŠ¡å™¨ç£ç›˜ç©ºé—´
   - Docker æ„å»ºå¤±è´¥ â†’ æ£€æŸ¥ Dockerfile è¯­æ³•

### éƒ¨ç½²åæœåŠ¡å¼‚å¸¸

```bash
# SSH åˆ°å¯¹åº”æœåŠ¡å™¨
ssh root@115.191.30.209

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose-master.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose-master.yml logs -f app-backend
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `.github/workflows/deploy.yml` | GitHub Actions å·¥ä½œæµé…ç½® |
| `deploy/setup-github-ssh.sh` | SSH å¯†é’¥é…ç½®è„šæœ¬ |
| `docker-compose-master.yml` | ä¸»æœåŠ¡å™¨ Docker é…ç½® |
| `docker-compose-worker.yml` | Worker èŠ‚ç‚¹ Docker é…ç½® |

## ğŸ”— å¿«é€Ÿé“¾æ¥

- **GitHub Actions**: https://github.com/lingtengjiao/amz_comment_translate/actions
- **GitHub Secrets**: https://github.com/lingtengjiao/amz_comment_translate/settings/secrets/actions
- **å‰ç«¯**: http://115.191.30.209:3000
- **API**: http://115.191.30.209:8000
- **Flower**: http://115.191.30.209:5555

<!-- æœ€åéƒ¨ç½²: 2026-01-11 22:40:02 -->
