# æ•°æ®åº“è¿æ¥ä¿¡æ¯

> **ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“é…ç½®æ–‡æ¡£**  
> æ›´æ–°æ—¶é—´: 2026-01-11

---

## ğŸ“Š æ•°æ®åº“æœåŠ¡å™¨ä¿¡æ¯

### æœåŠ¡å™¨ä½ç½®
- **ç‰©ç†ä½ç½®**: æœåŠ¡å™¨ A (ä¸»æœåŠ¡å™¨)
- **å…¬ç½‘IP**: 115.191.30.209
- **å†…ç½‘IP**: 192.168.36.36

---

## ğŸ” è¿æ¥å‡­è¯

| å‚æ•° | å€¼ |
|------|-----|
| **æ•°æ®åº“ç±»å‹** | PostgreSQL 15 |
| **ä¸»æœºåœ°å€ (å¤–ç½‘)** | 115.191.30.209 |
| **ä¸»æœºåœ°å€ (å†…ç½‘)** | 192.168.36.36 |
| **ç«¯å£** | 5432 |
| **æ•°æ®åº“å** | vocmaster |
| **ç”¨æˆ·å** | vocmaster |
| **å¯†ç ** | vocmaster123 |

---

## ğŸ’» è¿æ¥æ–¹å¼

### 1. å‘½ä»¤è¡Œè¿æ¥ (psql)

#### ä»å¤–ç½‘è¿æ¥
```bash
psql -h 115.191.30.209 -p 5432 -U vocmaster -d vocmaster
# å¯†ç : vocmaster123
```

#### ä»æœåŠ¡å™¨ B è¿æ¥ (å†…ç½‘)
```bash
psql -h 192.168.36.36 -p 5432 -U vocmaster -d vocmaster
# å¯†ç : vocmaster123
```

---

### 2. Docker å®¹å™¨å†…è¿æ¥

```bash
# SSH åˆ°æœåŠ¡å™¨ A
ssh root@115.191.30.209

# è¿›å…¥ PostgreSQL å®¹å™¨
docker exec -it voc-postgres psql -U vocmaster -d vocmaster
```

---

### 3. æ•°æ®åº“å®¢æˆ·ç«¯å·¥å…·

#### DBeaver / DataGrip / Navicat

**è¿æ¥é…ç½®**:
- Host: `115.191.30.209`
- Port: `5432`
- Database: `vocmaster`
- User: `vocmaster`
- Password: `vocmaster123`
- SSL: ä¸éœ€è¦ (å†…ç½‘ç¯å¢ƒ)

#### PgAdmin

```
Server Name: VOC-Master Production
Host name/address: 115.191.30.209
Port: 5432
Maintenance database: vocmaster
Username: vocmaster
Password: vocmaster123
```

---

### 4. Python è¿æ¥

```python
import psycopg2

conn = psycopg2.connect(
    host="115.191.30.209",
    port=5432,
    database="vocmaster",
    user="vocmaster",
    password="vocmaster123"
)

cursor = conn.cursor()
cursor.execute("SELECT version();")
print(cursor.fetchone())
conn.close()
```

---

### 5. è¿æ¥å­—ç¬¦ä¸²

#### PostgreSQL URL
```
postgresql://vocmaster:vocmaster123@115.191.30.209:5432/vocmaster
```

#### SQLAlchemy
```python
from sqlalchemy import create_engine

engine = create_engine(
    "postgresql://vocmaster:vocmaster123@115.191.30.209:5432/vocmaster"
)
```

---

## ğŸ”’ å®‰å…¨ç»„é…ç½®

### å½“å‰å¼€æ”¾ç«¯å£
| ç«¯å£ | æœåŠ¡ | è®¿é—®èŒƒå›´ |
|------|------|----------|
| 5432 | PostgreSQL | å…¬ç½‘ (0.0.0.0/0) |
| 6379 | Redis | å…¬ç½‘ (0.0.0.0/0) |
| 8000 | Backend API | å…¬ç½‘ (0.0.0.0/0) |
| 3000 | Frontend | å…¬ç½‘ (0.0.0.0/0) |
| 5555 | Flower | å…¬ç½‘ (0.0.0.0/0) |

âš ï¸ **ç”Ÿäº§ç¯å¢ƒå»ºè®®**: å°†æ•°æ®åº“ç«¯å£ 5432 é™åˆ¶ä¸ºä»…å†…ç½‘è®¿é—®ï¼Œæˆ–æ·»åŠ IPç™½åå•ã€‚

---

## ğŸ“ˆ æ•°æ®åº“çŠ¶æ€ç›‘æ§

### æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
```bash
# è¿æ¥æ£€æŸ¥
docker exec voc-postgres pg_isready -U vocmaster

# æŸ¥çœ‹æ´»è·ƒè¿æ¥
docker exec voc-postgres psql -U vocmaster -d vocmaster -c "SELECT count(*) FROM pg_stat_activity;"

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
docker exec voc-postgres psql -U vocmaster -d vocmaster -c "SELECT pg_size_pretty(pg_database_size('vocmaster'));"
```

---

## ğŸ—ƒï¸ æ•°æ®åº“å¤‡ä»½

### æ‰‹åŠ¨å¤‡ä»½
```bash
# å¤‡ä»½åˆ°æœ¬åœ°
docker exec voc-postgres pg_dump -U vocmaster vocmaster > backup_$(date +%Y%m%d_%H%M%S).sql

# ä»å¤‡ä»½æ¢å¤
cat backup_20260111_120000.sql | docker exec -i voc-postgres psql -U vocmaster -d vocmaster
```

---

## ğŸ“Š æ•°æ®åº“æ¶æ„

### ä¸»è¦æ•°æ®è¡¨

| è¡¨å | è¯´æ˜ | æ•°æ®é‡çº§ |
|------|------|---------|
| `products` | äº§å“ä¿¡æ¯ | ä¸­ç­‰ |
| `reviews` | è¯„è®ºåŸæ–‡ | å¤§ |
| `insights` | æ´å¯Ÿæå– | å¤§ |
| `themes` | ä¸»é¢˜èšç±» | å¤§ |
| `reports` | åˆ†ææŠ¥å‘Š | ä¸­ç­‰ |
| `users` | ç”¨æˆ·è´¦å· | å° |
| `user_projects` | ç”¨æˆ·å…³æ³¨ | å° |
| `tasks` | å¼‚æ­¥ä»»åŠ¡ | ä¸­ç­‰ |

### æŸ¥çœ‹è¡¨å¤§å°
```sql
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**: å½“å‰ä½¿ç”¨çš„æ˜¯é»˜è®¤å¯†ç ï¼Œ**ç”Ÿäº§ç¯å¢ƒè¯·å°½å¿«ä¿®æ”¹**
2. **ç½‘ç»œå®‰å…¨**: æ•°æ®åº“ç«¯å£å½“å‰å¯¹å…¬ç½‘å¼€æ”¾ï¼Œå»ºè®®é…ç½®é˜²ç«å¢™è§„åˆ™
3. **å®šæœŸå¤‡ä»½**: å»ºè®®é…ç½®è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡ï¼ˆæ¯æ—¥å¤‡ä»½ï¼‰
4. **è¿æ¥æ± **: å½“å‰é…ç½® `pool_size=20, max_overflow=40`
5. **æ€§èƒ½ç›‘æ§**: ä½¿ç”¨ Flower æˆ– pgAdmin ç›‘æ§æ•°æ®åº“æ€§èƒ½

---

## ğŸ”§ ä¿®æ”¹æ•°æ®åº“å¯†ç 

å¦‚éœ€ä¿®æ”¹å¯†ç ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. è¿›å…¥å®¹å™¨
docker exec -it voc-postgres psql -U vocmaster -d vocmaster

# 2. ä¿®æ”¹å¯†ç 
ALTER USER vocmaster WITH PASSWORD 'æ–°å¯†ç ';
\q

# 3. æ›´æ–° .env æ–‡ä»¶
cd /opt/voc
nano .env
# ä¿®æ”¹ POSTGRES_PASSWORD=æ–°å¯†ç 

# 4. é‡å¯æœåŠ¡
docker-compose -f docker-compose-master.yml restart app-backend
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡æ•°æ®åº“è¿æ¥é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨é˜²ç«å¢™é…ç½®
2. é˜¿é‡Œäº‘å®‰å…¨ç»„è§„åˆ™
3. PostgreSQL æœåŠ¡çŠ¶æ€
4. ç½‘ç»œè¿é€šæ€§

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2026-01-11
