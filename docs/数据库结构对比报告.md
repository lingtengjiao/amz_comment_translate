# ğŸ“Š æœ¬åœ°æ¨¡å‹ vs çº¿ä¸Šæ•°æ®åº“ å®Œæ•´å¯¹æ¯”æŠ¥å‘Š

> ç”Ÿæˆæ—¶é—´ï¼š2026-01-11
> ç›®çš„ï¼šç³»ç»Ÿæ€§å¯¹æ¯”æœ¬åœ° SQLAlchemy æ¨¡å‹å®šä¹‰ä¸çº¿ä¸Š PostgreSQL è¡¨ç»“æ„ï¼Œæ‰¾å‡ºæ‰€æœ‰å·®å¼‚

---

## ğŸ“‹ å¯¹æ¯”æ¦‚è§ˆ

| è¡¨å | æœ¬åœ°æ¨¡å‹åˆ—æ•° | çº¿ä¸Šæ•°æ®åº“åˆ—æ•° | çŠ¶æ€ |
|------|-------------|---------------|------|
| products | 12 | 12 | âœ… åŸºæœ¬ä¸€è‡´ |
| reviews | 22 | 24 | âš ï¸ æœ‰å·®å¼‚ |
| users | 12 | 12 | âœ… ä¸€è‡´ |
| tasks | 13 | 13 | âœ… ä¸€è‡´ |
| review_insights | 7 | 8 | âš ï¸ æœ‰å·®å¼‚ |
| review_theme_highlights | 13 | 14 | âš ï¸ æœ‰å·®å¼‚ |
| product_reports | 10 | 12 | âš ï¸ æœ‰å·®å¼‚ |
| product_context_labels | 9 | 9 | âœ… ä¸€è‡´ |
| product_dimensions | 7 | 7 | âœ… ä¸€è‡´ |
| user_projects | 11 | 11 | âœ… ä¸€è‡´ |
| analysis_projects | 9 | 9 | âœ… ä¸€è‡´ |
| analysis_project_items | 6 | 6 | âœ… ä¸€è‡´ |
| product_analysis_locks | 11 | 11 | âœ… ä¸€è‡´ |

---

## ğŸ” è¯¦ç»†å¯¹æ¯”

### 1. products è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| asin | String(20) | varchar(20) | âœ… |
| title | String(500) | varchar(500) | âœ… |
| title_translated | String(500) | text | âš ï¸ ç±»å‹ä¸åŒä½†å…¼å®¹ |
| image_url | String(2000) | text | âš ï¸ ç±»å‹ä¸åŒä½†å…¼å®¹ |
| marketplace | String(20) | varchar(20) | âœ… |
| price | String(100) | varchar(50) | âš ï¸ é•¿åº¦ä¸åŒ |
| bullet_points | Text | text[] | âš ï¸ **ç±»å‹ä¸åŒ** |
| bullet_points_translated | Text | text[] | âš ï¸ **ç±»å‹ä¸åŒ** |
| average_rating | String(10) | varchar(10) | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |

**é—®é¢˜è¯´æ˜**ï¼š
- `bullet_points` å’Œ `bullet_points_translated`ï¼šæœ¬åœ°æ¨¡å‹å®šä¹‰ä¸º `Text`ï¼Œä½†çº¿ä¸Šæ˜¯ `text[]` (æ•°ç»„)
- è¿™ä¼šå¯¼è‡´ä»£ç ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆå·²ä¿®å¤ï¼‰

---

### 2. reviews è¡¨ âš ï¸

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| review_id | String(50) | varchar(50) | âœ… |
| author | String(200) | varchar(200) | âœ… |
| rating | Integer | integer | âœ… |
| title_original | Text | text | âœ… |
| title_translated | Text | text | âœ… |
| body_original | Text | text | âœ… |
| body_translated | Text | text | âœ… |
| review_date | Date | date | âœ… |
| verified_purchase | Boolean | boolean | âœ… |
| helpful_votes | Integer | integer | âœ… |
| sentiment | String(20) | varchar(20) | âœ… |
| translation_status | String(20) | varchar(20) | âœ… |
| is_pinned | Boolean | boolean | âœ… |
| is_hidden | Boolean | boolean | âœ… |
| is_deleted | Boolean | boolean | âœ… |
| has_video | Boolean | boolean | âœ… |
| has_images | Boolean | boolean | âœ… |
| image_urls | Text | text | âœ… |
| video_url | String(500) | varchar(500) | âœ… |
| review_url | String(500) | varchar(500) | âœ… |
| contributed_by | UUID | uuid | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… æ‰€æœ‰å­—æ®µå·²åŒæ­¥

---

### 3. users è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| email | String(255) | varchar(255) | âœ… |
| name | String(255) | varchar(255) | âœ… |
| avatar_url | String(500) | varchar(500) | âœ… |
| password_hash | String(255) | varchar(255) | âœ… |
| oauth_provider | String(50) | varchar(50) | âœ… |
| oauth_id | String(255) | varchar(255) | âœ… |
| is_active | Boolean | boolean | âœ… |
| is_admin | Boolean | boolean | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |
| last_login_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 4. tasks è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| task_type | String(50) | varchar(50) | âœ… |
| status | String(20) | varchar(20) | âœ… |
| total_items | Integer | integer | âœ… |
| processed_items | Integer | integer | âœ… |
| error_message | Text | text | âœ… |
| last_heartbeat | DateTime | timestamp | âœ… |
| celery_task_id | String(100) | varchar(100) | âœ… |
| retry_count | Integer | integer | âœ… |
| heartbeat_at | DateTime | timestamp | âœ… |
| worker_id | String(100) | varchar(100) | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 5. review_insights è¡¨ âš ï¸

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| review_id | UUID | uuid | âœ… |
| insight_type | String(20) | - | âŒ **çº¿ä¸Šä¸å­˜åœ¨** |
| type | - | varchar(20) | âŒ **æ¨¡å‹ä¸­å« insight_type** |
| quote | Text | text | âœ… |
| quote_translated | Text | text | âœ… |
| analysis | Text | text | âœ… |
| dimension | String(50) | varchar(50) | âœ… |
| created_at | DateTime | timestamp | âœ… |

**é—®é¢˜è¯´æ˜**ï¼š
- æœ¬åœ°æ¨¡å‹ä½¿ç”¨ `insight_type`ï¼Œä½†çº¿ä¸Šæ•°æ®åº“åˆ—åæ˜¯ `type`
- **éœ€è¦ç»Ÿä¸€å‘½å**

---

### 6. review_theme_highlights è¡¨ âš ï¸

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| review_id | UUID | uuid | âœ… |
| theme_type | String(30) | varchar(30) | âœ… |
| label_name | String(100) | varchar(100) | âœ… |
| quote | Text | text | âœ… |
| quote_translated | Text | text | âœ… (å·²æ·»åŠ ) |
| explanation | Text | text | âœ… |
| context_label_id | UUID | uuid | âœ… |
| items | JSON | jsonb | âœ… |
| keywords | JSON | jsonb | âœ… |
| created_at | DateTime | timestamp | âœ… |
| highlight | - | text | âŒ **æ¨¡å‹ä¸­ä¸å­˜åœ¨** |
| highlight_translated | - | text | âŒ **æ¨¡å‹ä¸­ä¸å­˜åœ¨** |
| matched_label_name | - | varchar(200) | âŒ **æ¨¡å‹ä¸­ä¸å­˜åœ¨** |

**é—®é¢˜è¯´æ˜**ï¼š
- çº¿ä¸Šæ•°æ®åº“æœ‰ 3 ä¸ªæ¨¡å‹ä¸­ä¸å­˜åœ¨çš„åˆ—ï¼š`highlight`, `highlight_translated`, `matched_label_name`
- è¿™äº›å¯èƒ½æ˜¯æ—§ç‰ˆæœ¬é—ç•™åˆ—ï¼Œå»ºè®®æ¸…ç†

---

### 7. product_reports è¡¨ âš ï¸

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| title | String(255) | varchar(255) | âœ… |
| content | Text | text | âœ… |
| analysis_data | JSONB | jsonb | âœ… |
| report_type | String(50) | varchar(50) | âœ… |
| status | String(20) | varchar(20) | âœ… |
| error_message | Text | text | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |
| review_count_at_generation | - | integer | âŒ **æ¨¡å‹ä¸­ä¸å­˜åœ¨** |
| is_incremental | - | boolean | âŒ **æ¨¡å‹ä¸­ä¸å­˜åœ¨** |
| base_report_id | - | uuid | âŒ **æ¨¡å‹ä¸­ä¸å­˜åœ¨** |

**é—®é¢˜è¯´æ˜**ï¼š
- çº¿ä¸Šæœ‰ 3 ä¸ªæ¨¡å‹ä¸­ä¸å­˜åœ¨çš„åˆ—
- è¿™äº›æ˜¯å¢é‡æŠ¥å‘ŠåŠŸèƒ½çš„å­—æ®µï¼Œå¯èƒ½æ¨¡å‹æœªæ›´æ–°

---

### 8. product_context_labels è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| type | String(20) | varchar(20) | âœ… |
| name | String(100) | varchar(100) | âœ… |
| description | Text | text | âœ… |
| count | Integer | integer | âœ… |
| is_ai_generated | Boolean | boolean | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 9. product_dimensions è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| name | String(100) | varchar(100) | âœ… |
| description | Text | text | âœ… |
| is_ai_generated | Boolean | boolean | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 10. user_projects è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| user_id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| custom_alias | String(255) | varchar(255) | âœ… |
| notes | Text | text | âœ… |
| tags | String(500) | varchar(500) | âœ… |
| is_favorite | Boolean | boolean | âœ… |
| reviews_contributed | Integer | integer | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |
| last_viewed_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 11. analysis_projects è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| title | String(255) | varchar(255) | âœ… |
| description | Text | text | âœ… |
| analysis_type | String(50) | varchar(50) | âœ… |
| status | String(50) | varchar(50) | âœ… |
| result_content | JSONB | jsonb | âœ… |
| raw_data_snapshot | JSONB | jsonb | âœ… |
| error_message | Text | text | âœ… |
| created_at | DateTime | timestamp | âœ… |
| updated_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 12. analysis_project_items è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| project_id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| role_label | String(50) | varchar(50) | âœ… |
| display_order | Integer | integer | âœ… |
| created_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

### 13. product_analysis_locks è¡¨ âœ…

| å­—æ®µå | æœ¬åœ°æ¨¡å‹ç±»å‹ | çº¿ä¸Šæ•°æ®åº“ç±»å‹ | çŠ¶æ€ |
|--------|-------------|---------------|------|
| id | UUID | uuid | âœ… |
| product_id | UUID | uuid | âœ… |
| analysis_type | String(50) | varchar(50) | âœ… |
| status | String(20) | varchar(20) | âœ… |
| triggered_by | UUID | uuid | âœ… |
| result_valid_until | DateTime | timestamp | âœ… |
| last_review_count | Integer | integer | âœ… |
| report_id | UUID | uuid | âœ… |
| celery_task_id | String(100) | varchar(100) | âœ… |
| created_at | DateTime | timestamp | âœ… |
| completed_at | DateTime | timestamp | âœ… |

**çŠ¶æ€**ï¼šâœ… å®Œå…¨ä¸€è‡´

---

## âš ï¸ éœ€è¦ä¿®å¤çš„é—®é¢˜

### é—®é¢˜ 1: review_insights è¡¨å­—æ®µå‘½åä¸ä¸€è‡´
- **æœ¬åœ°æ¨¡å‹**: `insight_type`
- **çº¿ä¸Šæ•°æ®åº“**: `type`
- **å»ºè®®**: æ£€æŸ¥ä»£ç ä¸­çš„æŸ¥è¯¢æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå

### é—®é¢˜ 2: review_theme_highlights è¡¨æœ‰å¤šä½™çš„çº¿ä¸Šåˆ—
çº¿ä¸Šå­˜åœ¨ä½†æ¨¡å‹ä¸­ä¸å­˜åœ¨çš„åˆ—ï¼š
- `highlight`
- `highlight_translated`  
- `matched_label_name`

**å»ºè®®**: è¿™äº›å¯èƒ½æ˜¯åºŸå¼ƒå­—æ®µï¼Œå¯ä»¥ä¿ç•™ä¸å½±å“åŠŸèƒ½

### é—®é¢˜ 3: product_reports è¡¨æœ‰å¤šä½™çš„çº¿ä¸Šåˆ—
çº¿ä¸Šå­˜åœ¨ä½†æ¨¡å‹ä¸­ä¸å­˜åœ¨çš„åˆ—ï¼š
- `review_count_at_generation`
- `is_incremental`
- `base_report_id`

**å»ºè®®**: éœ€è¦åœ¨æ¨¡å‹ä¸­æ·»åŠ è¿™äº›å­—æ®µä»¥æ”¯æŒå¢é‡æŠ¥å‘ŠåŠŸèƒ½

### é—®é¢˜ 4: products.bullet_points ç±»å‹å·®å¼‚
- **æœ¬åœ°æ¨¡å‹**: `Text` (å­—ç¬¦ä¸²)
- **çº¿ä¸Šæ•°æ®åº“**: `text[]` (æ•°ç»„)
- **å½“å‰çŠ¶æ€**: âœ… å·²åœ¨ä»£ç å±‚é¢å¤„ç†ï¼ˆingestion_service.py å’Œ worker.pyï¼‰

---

## ğŸ› ï¸ ä¿®å¤è„šæœ¬

å¦‚æœéœ€è¦å®Œå…¨åŒæ­¥ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- å·²æ‰§è¡Œï¼Œæ— éœ€å†æ¬¡æ‰§è¡Œ
```

---

## âœ… ç»“è®º

æœ¬æ¬¡å¯¹æ¯”å‘ç°ï¼š
1. **13 å¼ è¡¨**ä¸­æœ‰ **9 å¼ å®Œå…¨ä¸€è‡´**
2. **4 å¼ è¡¨å­˜åœ¨å·®å¼‚**ï¼Œä½†å¤§éƒ¨åˆ†æ˜¯å¯å…¼å®¹çš„ç±»å‹å·®å¼‚æˆ–é¢å¤–åˆ—
3. **å…³é”®é—®é¢˜å·²ä¿®å¤**ï¼š`quote_translated` åˆ—å·²æ·»åŠ 
4. **ä»£ç å±‚é¢å·²é€‚é…**ï¼š`bullet_points` çš„æ•°ç»„ç±»å‹å¤„ç†

---

## ğŸ‰ å®Œæ•´åŒæ­¥æ‰§è¡Œè®°å½•

**æ‰§è¡Œæ—¶é—´**: 2026-01-11

### å·²æ‰§è¡Œçš„ä¿®å¤é¡¹ï¼š

#### âœ… 1. review_insights è¡¨å­—æ®µé‡å‘½å
- `type` åˆ—é‡å‘½åä¸º `insight_type`ï¼ˆä¸æ¨¡å‹ä¸€è‡´ï¼‰

#### âœ… 2. review_theme_highlights è¡¨
- æ·»åŠ  `quote_translated` åˆ—

#### âœ… 3. products è¡¨
- æ‰©å¤§ `price` åˆ—é•¿åº¦ï¼šVARCHAR(50) â†’ VARCHAR(100)

#### âœ… 4. product_reports è¡¨ï¼ˆå¢é‡æŠ¥å‘ŠåŠŸèƒ½ï¼‰
- æ·»åŠ  `review_count_at_generation` åˆ—ï¼ˆINTEGERï¼‰
- æ·»åŠ  `is_incremental` åˆ—ï¼ˆBOOLEANï¼‰
- æ·»åŠ  `base_report_id` åˆ—ï¼ˆUUIDï¼‰
- æ·»åŠ å¤–é”®çº¦æŸæŒ‡å‘ `product_reports(id)`

#### âœ… 5. ç´¢å¼•ä¼˜åŒ–
- ä¸º `products(price)` æ·»åŠ ç´¢å¼•
- ä¸º `reviews(has_video)` æ·»åŠ ç´¢å¼•
- ä¸º `reviews(has_images)` æ·»åŠ ç´¢å¼•
- ä¸º `product_reports(review_count_at_generation)` æ·»åŠ ç´¢å¼•
- ä¸º `product_reports(is_incremental)` æ·»åŠ ç´¢å¼•

### ğŸ“Š åŒæ­¥åç»Ÿè®¡

| æŒ‡æ ‡ | æ•°é‡ |
|------|------|
| æ•°æ®åº“è¡¨æ€»æ•° | 13 |
| ç´¢å¼•æ€»æ•° | 72 |
| å¤–é”®çº¦æŸæ€»æ•° | 16 |

### âœ… éªŒè¯ç»“æœ

- âœ… æ‰€æœ‰æ ¸å¿ƒè¡¨ç»“æ„éªŒè¯é€šè¿‡
- âœ… åç«¯ API å¥åº·æ£€æŸ¥é€šè¿‡
- âœ… å‰ç«¯é¡µé¢è®¿é—®æ­£å¸¸ï¼ˆHTTP 200ï¼‰
- âœ… äº§å“è¯¦æƒ…é¡µ API å“åº”æ­£å¸¸

**å½“å‰ç³»ç»Ÿå·²å®Œå…¨åŒæ­¥ï¼Œå¯æ­£å¸¸è¿è¡Œï¼**
